<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Runs Only Failed Tests • lazytest</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="48x48" href="favicon-48x48.png">
<link rel="icon" type="”image/svg+xml”" href="favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" sizes="any" href="favicon.ico">
<link rel="manifest" href="site.webmanifest">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Fira_Mono-0.4.9/font.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Runs Only Failed Tests">
<meta name="description" content="A companion package to the testthat package that saves development time by helping you rerun only the tests that have failed during the last run.">
<meta property="og:description" content="A companion package to the testthat package that saves development time by helping you rerun only the tests that have failed during the last run.">
<script defer data-domain="lazytest.cynkra.com" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <a href="https://cynkra.com" class="external-link"><img src="https://cynkra.com/assets/img/logo_small.svg" id="cynkra-logo-nav" alt="cynkra"></a>
    <a class="navbar-brand me-2" href="index.html">lazytest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9071</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cynkra/lazytest/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="lazytest">lazytest<a class="anchor" aria-label="anchor" href="#lazytest"></a>
</h1></div>
<!-- badges: start -->

<!-- badges: end -->
<pre class="chroma">
<span><span class="kr"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="o">(</span><span class="nv"><a href="https://github.com/cynkra/lazytest" class="external-link">lazytest</a></span><span class="o">)</span></span></pre>
<p>The goal of lazytest is to save development time by helping you rerun only the tests that have failed during the last run. It integrates tightly with the testthat package and provides the <a href="https://lazytest.cynkra.com/reference/lazytest_local.html"><code>lazytest_local()</code></a> function, a drop-in replacement for <a href="https://testthat.r-lib.org/reference/test_package.html" class="external-link"><code>testthat::test_local()</code></a>, that</p>
<ul>
<li>memoizes which tests have failed;</li>
<li>runs only those tests in subsequent runs.</li>
</ul>
<p>If all active tests have succeeded, the entire test suite is run in a second pass.</p>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>Call <a href="https://lazytest.cynkra.com/reference/lazytest_local.html"><code>lazytest_local()</code></a> instead of <a href="https://testthat.r-lib.org/reference/test_package.html" class="external-link"><code>testthat::test_local()</code></a> or <a href="https://devtools.r-lib.org/reference/test.html" class="external-link"><code>devtools::test()</code></a>:</p>
<pre class="chroma">
<span><span class="nf">lazytest</span><span class="nf">::</span><span class="nf"><a href="https://lazytest.cynkra.com/reference/lazytest_local.html">lazytest_local</a></span><span class="o">(</span><span class="o">)</span></span></pre>
<p>The package also provides RStudio add-ins that run the tests in a new terminal. Unfortunately, the “Test package” command is hard-wired to <a href="https://devtools.r-lib.org/reference/test.html" class="external-link"><code>devtools::test()</code></a>, and there seems to be no way to customize it or hook into it.</p>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>Let’s create a package with two boilerplate tests.</p>
<pre class="chroma">
<span><span class="nf">withr</span><span class="nf">::</span><span class="nf"><a href="https://withr.r-lib.org/reference/with_options.html" class="external-link">local_options</a></span><span class="o">(</span>usethis.quiet <span class="o">=</span> <span class="kc">TRUE</span><span class="o">)</span></span>
<span></span>
<span><span class="nv">pkg_parent_dir</span> <span class="o">&lt;-</span> <span class="nf">withr</span><span class="nf">::</span><span class="nf"><a href="https://withr.r-lib.org/reference/with_tempfile.html" class="external-link">local_tempdir</a></span><span class="o">(</span><span class="o">)</span></span>
<span><span class="nv">pkg_dir</span> <span class="o">&lt;-</span> <span class="nf"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="o">(</span><span class="nv">pkg_parent_dir</span>, <span class="s">"tea"</span><span class="o">)</span></span>
<span><span class="nf">usethis</span><span class="nf">::</span><span class="nf"><a href="https://usethis.r-lib.org/reference/create_package.html" class="external-link">create_package</a></span><span class="o">(</span><span class="nv">pkg_dir</span><span class="o">)</span></span>
<span><span class="nf">usethis</span><span class="nf">::</span><span class="nf"><a href="https://usethis.r-lib.org/reference/proj_utils.html" class="external-link">with_project</a></span><span class="o">(</span>path <span class="o">=</span> <span class="nv">pkg_dir</span>, <span class="o">{</span></span>
<span>  <span class="nf">usethis</span><span class="nf">::</span><span class="nf"><a href="https://usethis.r-lib.org/reference/use_testthat.html" class="external-link">use_testthat</a></span><span class="o">(</span><span class="o">)</span></span>
<span>  <span class="nf">usethis</span><span class="nf">::</span><span class="nf"><a href="https://usethis.r-lib.org/reference/use_r.html" class="external-link">use_test</a></span><span class="o">(</span><span class="s">"blop"</span><span class="o">)</span></span>
<span>  <span class="nf">usethis</span><span class="nf">::</span><span class="nf"><a href="https://usethis.r-lib.org/reference/use_r.html" class="external-link">use_test</a></span><span class="o">(</span><span class="s">"blip"</span><span class="o">)</span></span>
<span><span class="o">}</span><span class="o">)</span></span></pre>
<p>If we run the tests, they all pass.</p>
<pre class="chroma">
<span><span class="nf">withr</span><span class="nf">::</span><span class="nf"><a href="https://withr.r-lib.org/reference/with_dir.html" class="external-link">with_dir</a></span><span class="o">(</span></span>
<span>  <span class="nv">pkg_dir</span>,</span>
<span>  <span class="nf">lazytest</span><span class="nf">::</span><span class="nf"><a href="https://lazytest.cynkra.com/reference/lazytest_local.html">lazytest_local</a></span><span class="o">(</span><span class="o">)</span></span>
<span><span class="o">)</span></span>
<span><span class="c">#&gt; <span style="color: #00BBBB;">ℹ</span> Testing all tests.</span></span>
<span><span class="c">#&gt; <span style="color: #00BB00;">✔</span> | <span style="color: #BBBB00;">F</span> <span style="color: #BB00BB;">W</span> <span style="color: #0000BB;">S</span> <span style="color: #00BB00;"> OK</span> | Context</span></span>
<span><span class="c">#&gt; ⠏ |         0 | blip                                                            <span style="color: #00BB00;">✔</span> |         1 | blip</span></span>
<span><span class="c">#&gt; ⠏ |         0 | blop                                                            <span style="color: #00BB00;">✔</span> |         1 | blop</span></span>
<span><span class="c">#&gt; </span></span>
<span><span class="c">#&gt; ══ <span style="font-weight: bold;">Results</span> ═════════════════════════════════════════════════════════════════════</span></span>
<span><span class="c">#&gt; [ FAIL 0 | WARN 0 | SKIP 0 | <span style="color: #00BB00;">PASS</span> 2 ]</span></span>
<span><span class="c">#&gt; → Testing all tests next time.</span></span></pre>
<p>Now if we replace one of the tests with a failing test,</p>
<pre class="chroma">
<span><span class="nf">brio</span><span class="nf">::</span><span class="nf"><a href="https://brio.r-lib.org/reference/write_lines.html" class="external-link">write_lines</a></span><span class="o">(</span></span>
<span>  text <span class="o">=</span>  <span class="nf"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="o">(</span></span>
<span>    <span class="s">'test_that("blop() works", {'</span>,</span>
<span>    <span class="s">'expect_equal(2 * 2, 42)'</span>,</span>
<span>    <span class="s">'})'</span></span>
<span>  <span class="o">)</span>,</span>
<span>  path <span class="o">=</span> <span class="nf"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="o">(</span><span class="nv">pkg_dir</span>, <span class="s">"tests"</span>, <span class="s">"testthat"</span>, <span class="s">"test-blop.R"</span><span class="o">)</span></span>
<span><span class="o">)</span></span></pre>
<p>and then run the tests,</p>
<pre class="chroma">
<span><span class="nf">withr</span><span class="nf">::</span><span class="nf"><a href="https://withr.r-lib.org/reference/with_dir.html" class="external-link">with_dir</a></span><span class="o">(</span></span>
<span>  <span class="nv">pkg_dir</span>,</span>
<span>  <span class="nf">lazytest</span><span class="nf">::</span><span class="nf"><a href="https://lazytest.cynkra.com/reference/lazytest_local.html">lazytest_local</a></span><span class="o">(</span><span class="o">)</span></span>
<span><span class="o">)</span></span>
<span><span class="c">#&gt; <span style="color: #00BBBB;">ℹ</span> Testing all tests.</span></span>
<span><span class="c">#&gt; <span style="color: #00BB00;">✔</span> | <span style="color: #BBBB00;">F</span> <span style="color: #BB00BB;">W</span> <span style="color: #0000BB;">S</span> <span style="color: #00BB00;"> OK</span> | Context</span></span>
<span><span class="c">#&gt; ⠏ |         0 | blip                                                            <span style="color: #00BB00;">✔</span> |         1 | blip</span></span>
<span><span class="c">#&gt; ⠏ |         0 | blop                                                            ⠋ | 1       0 | blop                                                            <span style="color: #BB0000;">✖</span> | <span style="color: #BBBB00;">1</span>       0 | blop<span style="color: #555555;"> [0.2s]</span></span></span>
<span><span class="c">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="c">#&gt; <span style="color: #BBBB00; font-weight: bold;">Failure</span><span style="font-weight: bold;"> (</span><span style="color: #0000BB; font-weight: bold;">test-blop.R:2:1</span><span style="font-weight: bold;">): blop() works</span></span></span>
<span><span class="c">#&gt; 2 * 2 (`actual`) not equal to 42 (`expected`).</span></span>
<span><span class="c">#&gt; </span></span>
<span><span class="c">#&gt;   `actual`:  <span style="color: #00BB00;">4</span></span></span>
<span><span class="c">#&gt; `expected`: <span style="color: #00BB00;">42</span></span></span>
<span><span class="c">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="c">#&gt; </span></span>
<span><span class="c">#&gt; ══ <span style="font-weight: bold;">Results</span> ═════════════════════════════════════════════════════════════════════</span></span>
<span><span class="c">#&gt; <span style="color: #00BBBB;">Duration: 0.3 s</span></span></span>
<span><span class="c">#&gt; </span></span>
<span><span class="c">#&gt; [ <span style="color: #BBBB00;">FAIL</span> 1 | WARN 0 | SKIP 0 | PASS 1 ]</span></span>
<span><span class="c">#&gt; → Testing the following tests next time:</span></span>
<span><span class="c">#&gt; <span style="color: #00BBBB;">•</span> blop</span></span>
<span><span class="c">#&gt; Error: Test failures</span></span></pre>
<p>a file is created with the failing test name:</p>
<pre class="chroma">
<span><span class="nf">brio</span><span class="nf">::</span><span class="nf"><a href="https://brio.r-lib.org/reference/read_lines.html" class="external-link">read_lines</a></span><span class="o">(</span><span class="nf"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="o">(</span><span class="nv">pkg_dir</span>, <span class="s">".lazytest"</span><span class="o">)</span><span class="o">)</span></span>
<span><span class="c">#&gt; [1] "blop"</span></span></pre>
<p>Next time we run the tests, only this test will be run, until it is fixed at which point all tests are run again to check no failure has been introduced elsewhere.</p>
<pre class="chroma">
<span><span class="nf">withr</span><span class="nf">::</span><span class="nf"><a href="https://withr.r-lib.org/reference/with_dir.html" class="external-link">with_dir</a></span><span class="o">(</span></span>
<span>  <span class="nv">pkg_dir</span>,</span>
<span>  <span class="nf">lazytest</span><span class="nf">::</span><span class="nf"><a href="https://lazytest.cynkra.com/reference/lazytest_local.html">lazytest_local</a></span><span class="o">(</span><span class="o">)</span></span>
<span><span class="o">)</span></span>
<span><span class="c">#&gt; <span style="color: #00BBBB;">ℹ</span> Testing only tests that failed last time:</span></span>
<span><span class="c">#&gt; <span style="color: #00BBBB;">•</span> blop</span></span>
<span><span class="c">#&gt; <span style="color: #00BB00;">✔</span> | <span style="color: #BBBB00;">F</span> <span style="color: #BB00BB;">W</span> <span style="color: #0000BB;">S</span> <span style="color: #00BB00;"> OK</span> | Context</span></span>
<span><span class="c">#&gt; ⠏ |         0 | blop                                                            <span style="color: #BB0000;">✖</span> | <span style="color: #BBBB00;">1</span>       0 | blop</span></span>
<span><span class="c">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="c">#&gt; <span style="color: #BBBB00; font-weight: bold;">Failure</span><span style="font-weight: bold;"> (</span><span style="color: #0000BB; font-weight: bold;">test-blop.R:2:1</span><span style="font-weight: bold;">): blop() works</span></span></span>
<span><span class="c">#&gt; 2 * 2 (`actual`) not equal to 42 (`expected`).</span></span>
<span><span class="c">#&gt; </span></span>
<span><span class="c">#&gt;   `actual`:  <span style="color: #00BB00;">4</span></span></span>
<span><span class="c">#&gt; `expected`: <span style="color: #00BB00;">42</span></span></span>
<span><span class="c">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="c">#&gt; </span></span>
<span><span class="c">#&gt; ══ <span style="font-weight: bold;">Results</span> ═════════════════════════════════════════════════════════════════════</span></span>
<span><span class="c">#&gt; [ <span style="color: #BBBB00;">FAIL</span> 1 | WARN 0 | SKIP 0 | PASS 0 ]</span></span>
<span><span class="c">#&gt; → Repeating the same tests next time.</span></span>
<span><span class="c">#&gt; Error: Test failures</span></span></pre>
</div>
<div class="section level2">
<h2 id="how-does-it-work">How does it work?<a class="anchor" aria-label="anchor" href="#how-does-it-work"></a>
</h2>
<p><a href="https://testthat.r-lib.org/reference/test_package.html" class="external-link"><code>testthat::test_local()</code></a> returns an object from which the tests that have failed can be retrieved. <a href="https://lazytest.cynkra.com/reference/lazytest_local.html"><code>lazytest_local()</code></a> wraps this function. If tests have failed, a file named <code>.lazytest</code> is written in the package directory. In the next call, if <code>.lazytest</code> exists, it is consulted, and a suitable <code>filter</code> argument is constructed and passed to <a href="https://testthat.r-lib.org/reference/test_package.html" class="external-link"><code>testthat::test_local()</code></a>.</p>
<p>When all tests have passed and not all tests were run, a second call to <a href="https://testthat.r-lib.org/reference/test_package.html" class="external-link"><code>testthat::test_local()</code></a> is initiated, to make sure that no failures have been introduced in the meantime.</p>
<p>The presence of a <code>.lazytest</code> file in the package source indicates that the last test run has failed somewhere. You should not need to gitignore or Rbuildignore it: you should fix the reason behind the test failure, then run tests again, before committing to your repository’s default branch for instance.</p>
</div>
<div class="section level2">
<h2 id="installation-and-optional-setup">Installation and optional setup<a class="anchor" aria-label="anchor" href="#installation-and-optional-setup"></a>
</h2>
<p>You can install the development version of lazytest from <a href="https://cynkra.r-universe.dev/" class="external-link">cynkra R-universe</a>:</p>
<pre class="chroma">
<span><span class="nf"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="o">(</span><span class="s">'lazytest'</span>, repos <span class="o">=</span> <span class="nf"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="o">(</span><span class="s">'https://cynkra.r-universe.dev'</span>, <span class="s">'https://cloud.r-project.org'</span><span class="o">)</span><span class="o">)</span></span></pre>
<p>Or from GitHub:</p>
<pre class="chroma">
<span><span class="nf">pak</span><span class="nf">::</span><span class="nf"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="o">(</span><span class="s">"krlmlr/lazytest"</span><span class="o">)</span></span></pre>
<p>If you’re using RStudio, it is a good idea to remap the shortcut for running tests (default: Ctrl + Shift + T / Cmd + Shift + T). The add-in provides two commands:</p>
<ul>
<li><p>Run Lazy Tests in New Terminal (recommended mapping: Ctrl + Shift + T / Cmd + Shift + T)</p></li>
<li><p>Reset And Run Lazy Tests in New Terminal (recommended mapping: Ctrl + T / Cmd + T)</p></li>
</ul>
<p>This allows you to keep the workflows you’re accustomed to and to benefit immediately.</p>
<div class="float">
<img src="https://github.com/cynkra/lazytest/raw/main/readme/rstudio-kb.png" alt="RStudio shortcut configuration"><div class="figcaption">RStudio shortcut configuration</div>
</div>
<hr>
</div>
<div class="section level2">
<h2 id="code-of-conduct">Code of Conduct<a class="anchor" aria-label="anchor" href="#code-of-conduct"></a>
</h2>
<p>Please note that the lazytest project is released with a <a href="https://contributor-covenant.org/version/2/1/CODE_OF_CONDUCT.html" class="external-link">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/cynkra/lazytest/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/cynkra/lazytest/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing lazytest</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://cynkra.com/about/" class="external-link">Kirill Müller</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-1416-3412" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>cynkra GmbH <br><small class="roles"> Funder, copyright holder </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/cynkra/lazytest/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/cynkra/lazytest/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://CRAN.R-project.org/package=lazytest" class="external-link"><img src="https://www.r-pkg.org/badges/version/lazytest" alt="CRAN status"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://cynkra.com/about/" class="external-link">Kirill Müller</a>, cynkra GmbH.</p>
</div>

<div class="pkgdown-footer-right">
  <p>
Sponsored by <a href="https://cynkra.com" class="external-link"><img src="https://cynkra.com/assets/img/logo_small.svg" id="cynkra-logo-footer" alt="cynkra"></a>
</p>
</div>

    </footer>
</div>





  </body>
</html>
