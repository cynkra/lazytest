<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Test a local source package — lazytest_local • lazytest</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Fira_Mono-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Test a local source package — lazytest_local"><meta name="description" content="A drop-in replacement for testthat::test_local() that by default reruns
only the tests that failed last time."><meta property="og:description" content="A drop-in replacement for testthat::test_local() that by default reruns
only the tests that failed last time."><script defer data-domain="lazytest.cynkra.com" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <a href="https://cynkra.com" class="external-link"><img src="https://cynkra.com/assets/img/logo_small.svg" id="cynkra-logo-nav" alt="cynkra"></a>
    <a class="navbar-brand me-2" href="../index.html">lazytest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9060</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cynkra/lazytest/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Test a local source package</h1>
      <small class="dont-index">Source: <a href="https://github.com/cynkra/lazytest/blob/main/R/lazytest_local.R" class="external-link"><code>R/lazytest_local.R</code></a></small>
      <div class="d-none name"><code>lazytest_local.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>A drop-in replacement for <code><a href="https://testthat.r-lib.org/reference/test_package.html" class="external-link">testthat::test_local()</a></code> that by default reruns
only the tests that failed last time.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">lazytest_local</span><span class="op">(</span></span>
<span>  path <span class="op">=</span> <span class="st">"."</span>,</span>
<span>  reporter <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  lazytest_reset <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  stop_on_failure <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  stop_on_warning <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  filter <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  load_package <span class="op">=</span> <span class="st">"source"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-path">path<a class="anchor" aria-label="anchor" href="#arg-path"></a></dt>
<dd><p>Path to directory containing tests.</p></dd>


<dt id="arg-reporter">reporter<a class="anchor" aria-label="anchor" href="#arg-reporter"></a></dt>
<dd><p>Reporter to use to summarise output. Can be supplied
as a string (e.g. "summary") or as an R6 object
(e.g. <code>SummaryReporter$new()</code>).</p>
<p>See <a href="https://testthat.r-lib.org/reference/Reporter.html" class="external-link">Reporter</a> for more details and a list of built-in reporters.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to <code><a href="https://testthat.r-lib.org/reference/test_dir.html" class="external-link">test_dir()</a></code></p></dd>


<dt id="arg-lazytest-reset">lazytest_reset<a class="anchor" aria-label="anchor" href="#arg-lazytest-reset"></a></dt>
<dd><p>Set to <code>TRUE</code> to run all tests, regardless of what the
last test results were.</p></dd>


<dt id="arg-stop-on-failure">stop_on_failure<a class="anchor" aria-label="anchor" href="#arg-stop-on-failure"></a></dt>
<dd><p>If <code>TRUE</code>, throw an error if any tests fail.</p></dd>


<dt id="arg-stop-on-warning">stop_on_warning<a class="anchor" aria-label="anchor" href="#arg-stop-on-warning"></a></dt>
<dd><p>If <code>TRUE</code>, throw an error if any tests generate
warnings.</p></dd>


<dt id="arg-filter">filter<a class="anchor" aria-label="anchor" href="#arg-filter"></a></dt>
<dd><p>Must be <code>NULL</code>.</p></dd>


<dt id="arg-load-package">load_package<a class="anchor" aria-label="anchor" href="#arg-load-package"></a></dt>
<dd><p>Strategy to use for load package code:</p><ul><li><p>"none", the default, doesn't load the package.</p></li>
<li><p>"installed", uses <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code> to load an installed package.</p></li>
<li><p>"source", uses <code><a href="https://pkgload.r-lib.org/reference/load_all.html" class="external-link">pkgload::load_all()</a></code> to a source package.
To configure the arguments passed to <code>load_all()</code>, add this
field in your DESCRIPTION file:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>Config<span class="sc">/</span>testthat<span class="sc">/</span>load<span class="sc">-</span>all<span class="sc">:</span> <span class="fu">list</span>(<span class="at">export_all =</span> <span class="cn">FALSE</span>, <span class="at">helpers =</span> <span class="cn">FALSE</span>)</span></code></pre><p></p></div></li>
</ul></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list (invisibly) containing data about the test results,
like <code><a href="https://testthat.r-lib.org/reference/test_package.html" class="external-link">testthat::test_local()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a></h2>



<p>Let's create a package with two boilerplate tests.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html" class="external-link">local_seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_options.html" class="external-link">local_options</a></span><span class="op">(</span>usethis.quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pkg_parent_dir</span> <span class="op">&lt;-</span> <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_tempfile.html" class="external-link">local_tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pkg_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">pkg_parent_dir</span>, <span class="st">"tea"</span><span class="op">)</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/create_package.html" class="external-link">create_package</a></span><span class="op">(</span><span class="va">pkg_dir</span><span class="op">)</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/proj_utils.html" class="external-link">with_project</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">pkg_dir</span>, <span class="op">{</span></span>
<span>  <span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_testthat.html" class="external-link">use_testthat</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_r.html" class="external-link">use_test</a></span><span class="op">(</span><span class="st">"blop"</span><span class="op">)</span></span>
<span>  <span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_r.html" class="external-link">use_test</a></span><span class="op">(</span><span class="st">"blip"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre><p></p></div>
<p>If we run the tests, they all pass.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_dir.html" class="external-link">with_dir</a></span><span class="op">(</span></span>
<span>  <span class="va">pkg_dir</span>,</span>
<span>  <span class="fu">lazytest</span><span class="fu">::</span><span class="fu"><a href="../reference/lazytest_local.html">lazytest_local</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; i Testing all tests.</span></span>
<span><span class="co">#&gt; v | F W  S  OK | Context</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; / |          0 | blip</span></span>
<span><span class="co">#&gt; v |          1 | blip</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; / |          0 | blop</span></span>
<span><span class="co">#&gt; v |          1 | blop</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; == Results =====================================================================</span></span>
<span><span class="co">#&gt; [ FAIL 0 | WARN 0 | SKIP 0 | PASS 2 ]</span></span>
<span><span class="co">#&gt; &gt; Testing all tests next time.</span></span></code></pre><p></p></div>
<p>Now if we replace one of the tests with a failing test,</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">brio</span><span class="fu">::</span><span class="fu"><a href="https://brio.r-lib.org/reference/write_lines.html" class="external-link">write_lines</a></span><span class="op">(</span></span>
<span>  text <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">'test_that("blop() works", {'</span>,</span>
<span>    <span class="st">'expect_equal(2 * 2, 42)'</span>,</span>
<span>    <span class="st">'})'</span></span>
<span>  <span class="op">)</span>,</span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">pkg_dir</span>, <span class="st">"tests"</span>, <span class="st">"testthat"</span>, <span class="st">"test-blop.R"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre><p></p></div>
<p>and then run the tests,</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_dir.html" class="external-link">with_dir</a></span><span class="op">(</span></span>
<span>  <span class="va">pkg_dir</span>,</span>
<span>  <span class="fu">lazytest</span><span class="fu">::</span><span class="fu"><a href="../reference/lazytest_local.html">lazytest_local</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; i Testing all tests.</span></span>
<span><span class="co">#&gt; v | F W  S  OK | Context</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; / |          0 | blip</span></span>
<span><span class="co">#&gt; v |          1 | blip</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; / |          0 | blop</span></span>
<span><span class="co">#&gt; - | 1        0 | blop</span></span>
<span><span class="co">#&gt; x | 1        0 | blop</span></span>
<span><span class="co">#&gt; --------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; Failure ('test-blop.R:2:1'): blop() works</span></span>
<span><span class="co">#&gt; 2 * 2 (`actual`) not equal to 42 (`expected`).</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt;   `actual`:  4</span></span>
<span><span class="co">#&gt; `expected`: 42</span></span>
<span><span class="co">#&gt; --------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; == Results =====================================================================</span></span>
<span><span class="co">#&gt; -- Failed tests ----------------------------------------------------------------</span></span>
<span><span class="co">#&gt; Failure ('test-blop.R:2:1'): blop() works</span></span>
<span><span class="co">#&gt; 2 * 2 (`actual`) not equal to 42 (`expected`).</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt;   `actual`:  4</span></span>
<span><span class="co">#&gt; `expected`: 42</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; [ FAIL 1 | WARN 0 | SKIP 0 | PASS 1 ]</span></span>
<span><span class="co">#&gt; &gt; Testing the following tests next time:</span></span>
<span><span class="co">#&gt; * blop</span></span>
<span><span class="co">#&gt; Error: Test failures</span></span></code></pre><p></p></div>
<p>a file is created with the failing test name:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">brio</span><span class="fu">::</span><span class="fu"><a href="https://brio.r-lib.org/reference/read_lines.html" class="external-link">read_lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">pkg_dir</span>, <span class="st">".lazytest"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "blop"</span></span></code></pre><p></p></div>
<p>Next time we run the tests, only this test will be run, until it is fixed at which point all tests are run again to check no failure has been introduced elsewhere.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_dir.html" class="external-link">with_dir</a></span><span class="op">(</span></span>
<span>  <span class="va">pkg_dir</span>,</span>
<span>  <span class="fu">lazytest</span><span class="fu">::</span><span class="fu"><a href="../reference/lazytest_local.html">lazytest_local</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; i Testing only tests that failed last time:</span></span>
<span><span class="co">#&gt; * blop</span></span>
<span><span class="co">#&gt; v | F W  S  OK | Context</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; / |          0 | blop</span></span>
<span><span class="co">#&gt; x | 1        0 | blop</span></span>
<span><span class="co">#&gt; --------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; Failure ('test-blop.R:2:1'): blop() works</span></span>
<span><span class="co">#&gt; 2 * 2 (`actual`) not equal to 42 (`expected`).</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt;   `actual`:  4</span></span>
<span><span class="co">#&gt; `expected`: 42</span></span>
<span><span class="co">#&gt; --------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; == Results =====================================================================</span></span>
<span><span class="co">#&gt; -- Failed tests ----------------------------------------------------------------</span></span>
<span><span class="co">#&gt; Failure ('test-blop.R:2:1'): blop() works</span></span>
<span><span class="co">#&gt; 2 * 2 (`actual`) not equal to 42 (`expected`).</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt;   `actual`:  4</span></span>
<span><span class="co">#&gt; `expected`: 42</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; [ FAIL 1 | WARN 0 | SKIP 0 | PASS 0 ]</span></span>
<span><span class="co">#&gt; &gt; Repeating the same tests next time.</span></span>
<span><span class="co">#&gt; Error: Test failures</span></span></code></pre><p></p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://cynkra.com/about/" class="external-link">Kirill Müller</a>, cynkra GmbH.</p>
</div>

<div class="pkgdown-footer-right">
  <p>
Sponsored by <a href="https://cynkra.com" class="external-link"><img src="https://cynkra.com/assets/img/logo_small.svg" id="cynkra-logo-footer" alt="cynkra"></a>
</p>
</div>

    </footer></div>





  </body></html>

